@model Laptop88_3.Models.Order

@{
    ViewBag.Title = "Chi tiết đơn hàng";
    Layout = "~/Views/Shared/_Layout.cshtml";
}

<div class="order-details">
    <h2>Chi tiết đơn hàng #@Model.OrderID</h2>

    <div class="order-info">
        <p><b>Khách hàng:</b> @Model.User?.Username</p>
        <p><b>Ngày đặt:</b> @Model.OrderDate.ToString("dd/MM/yyyy HH:mm")</p>
        <p><b>Trạng thái:</b> @Model.Status</p>
        <p><b>Địa chỉ giao hàng:</b> @Model.ShippingAddress</p>
    </div>

    <h3>Sản phẩm trong đơn hàng</h3>
    <table class="table table-bordered">
        <thead>
            <tr>
                <th>Ảnh</th>
                <th>Sản phẩm</th>
                <th>Số lượng</th>
                <th>Đơn giá</th>
                <th>Khuyến mãi</th>
                <th>Thành tiền</th>
            </tr>
        </thead>
        <tbody>
            @foreach (var detail in Model.OrderDetails)
            {
                var product = detail.Product;
                decimal lineTotal = detail.Quantity * detail.UnitPrice;

                var promo = product?.ProductPromotions
                    ?.Where(pp => pp.Promotion.IsActive &&
                                  pp.Promotion.StartDate <= DateTime.Now &&
                                  pp.Promotion.EndDate >= DateTime.Now)
                    .Select(pp => pp.Promotion)
                    .FirstOrDefault();

                <tr>
                    <td>
                        <img src="~/Picture/product/@product.ImageURL" alt="@product.ProductName" style="width:80px;" />
                    </td>
                    <td>@product.ProductName</td>
                    <td>@detail.Quantity</td>
                    <td>@detail.UnitPrice.ToString("N0") ₫</td>
                    <td>
                        @if (promo != null)
                        {
                            <span>Giảm @promo.DiscountPercent% </span><br />
                            <span>@promo.Description</span>
                        }
                        else
                        {
                            <span>Không có</span>
                        }
                    </td>
                    <td>@lineTotal.ToString("N0") ₫</td>
                </tr>
            }
        </tbody>
    </table>

    <div class="order-summary" style="margin-top:20px; text-align:right;">
        <h4>Tổng cộng: <span style="color:red;">@Model.TotalAmount.ToString("N0") ₫</span></h4>
    </div>

    <div class="gift-section" style="margin-top:20px;">
        <h3>Quà tặng kèm</h3>
        <ul>
            <li>Tặng voucher 200.000 ₫</li>
            <li>Balo laptop chính hãng</li>
            <li>Chuột không dây</li>
        </ul>
    </div>
</div>
