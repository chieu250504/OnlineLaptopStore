@model Laptop88_3.Controllers.PromotionCreateViewModel

@{
    ViewBag.Title = "Chỉnh sửa khuyến mãi";
    Layout = "~/Views/Shared/_LayoutAdmin.cshtml";
}

<div class="product-form-container">
    <h2>Chỉnh sửa khuyến mãi</h2>

    @using (Html.BeginForm("Edit", "PromotionManagement", FormMethod.Post, new { @id = "editPromotionForm" }))
    {
        @Html.AntiForgeryToken()
        @Html.HiddenFor(m => m.PromotionID)

        <div class="form-group">
            @Html.LabelFor(m => m.PromotionName, "Tên khuyến mãi")
            @Html.TextBoxFor(m => m.PromotionName, new { @class = "form-control" })
            @Html.ValidationMessageFor(m => m.PromotionName, "", new { @class = "text-danger" })
        </div>

        <div class="form-group">
            @Html.LabelFor(m => m.Description, "Mô tả")
            @Html.TextAreaFor(m => m.Description, new { @class = "form-control", rows = 3 })
        </div>

        <div class="form-group">
            @Html.LabelFor(m => m.DiscountPercent, "Giảm %")
            @Html.TextBoxFor(m => m.DiscountPercent, "{0:0.##}", new { @class = "form-control" })
        </div>

        <div class="form-group">
            @Html.LabelFor(m => m.PricePromotion, "Giá khuyến mãi")
            @Html.TextBoxFor(m => m.PricePromotion, "{0:0.##}", new { @class = "form-control" })
        </div>

        <div class="form-group">
            @Html.LabelFor(m => m.StartDate, "Ngày bắt đầu")
            @Html.TextBoxFor(m => m.StartDate, "{0:yyyy-MM-dd}", new { @class = "form-control", type = "date" })
        </div>

        <div class="form-group">
            @Html.LabelFor(m => m.EndDate, "Ngày kết thúc")
            @Html.TextBoxFor(m => m.EndDate, "{0:yyyy-MM-dd}", new { @class = "form-control", type = "date" })
        </div>

        <div class="form-group">
            <label>Áp dụng cho sản phẩm</label>
            <div class="checkbox-container">
                @foreach (var product in Model.Products)
                {
                    <div class="checkbox-item">
                        <input type="checkbox"
                               name="SelectedProductIDs"
                               value="@product.Value"
                               @(Model.SelectedProductIDs.Contains(product.Value) ? "checked" : "") />
                        <span>@product.Text</span>
                    </div>
                }
            </div>
        </div>

        <div class="form-group">
            <label>Quà tặng đi kèm</label>
            <div class="checkbox-container">
                @foreach (var gift in Model.Gifts)
                {
                    <div class="checkbox-item">
                        <input type="checkbox"
                               name="SelectedGiftProductIDs"
                               value="@gift.Value"
                               @(Model.SelectedGiftProductIDs.Contains(gift.Value) ? "checked" : "") />
                        <span>@gift.Text</span>
                    </div>
                }
            </div>
        </div>

        <div class="form-group">
            @Html.LabelFor(m => m.DisplayType, "Loại khuyến mãi")
            @Html.DropDownListFor(m => m.DisplayType,
                new List<SelectListItem>
                {
                    new SelectListItem { Text = "Khuyến mãi thông thường", Value = "1" },
                    new SelectListItem { Text = "Khuyến mãi HOT", Value = "2" }
                },
                "-- Chọn loại --",
                new { @class = "form-control" })
        </div>

        <div class="form-group">
            <label>Trạng thái</label>
            @Html.CheckBoxFor(m => m.IsActive) <span>Kích hoạt</span>
        </div>

        <button type="submit" class="create-btn">Cập nhật khuyến mãi</button>
        <a href="@Url.Action("Index", "PromotionManagement")" class="create-btn" style="background-color:#6c757d;">Hủy</a>
    }
</div>

<script src="https://cdn.jsdelivr.net/npm/sweetalert2@11"></script>

<script>
    document.getElementById("editPromotionForm").addEventListener("submit", function (e) {
        e.preventDefault();

        Swal.fire({
            title: "Xác nhận cập nhật?",
            text: "Bạn có chắc chắn muốn cập nhật khuyến mãi này?",
            icon: "warning",
            showCancelButton: true,
            confirmButtonText: "Cập nhật",
            cancelButtonText: "Hủy"
        }).then((result) => {
            if (result.isConfirmed) {
                e.target.submit(); 
            }
        });
    });
</script>
